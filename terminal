import sqlite3

# Conectar a la base de datos
def conectar_bd():
    return sqlite3.connect("inventario.db")

# Inicializar la base de datos
def inicializar_bd():
    with conectar_bd() as con:
        cur = con.cursor()
        cur.execute('''CREATE TABLE IF NOT EXISTS productos (
                        id INTEGER PRIMARY KEY AUTOINCREMENT,
                        nombre TEXT NOT NULL,
                        cantidad INTEGER NOT NULL,
                        precio REAL NOT NULL,
                        fecha_compra TEXT,
                        fecha_venta TEXT
                    )''')
        con.commit()

# Agregar un producto al inventario
def agregar_producto():
    nombre = input("Nombre del producto: ")
    cantidad = int(input("Cantidad: "))
    precio = float(input("Precio: "))
    fecha_compra = input("Fecha de compra (YYYY-MM-DD): ")
    
    with conectar_bd() as con:
        cur = con.cursor()
        cur.execute("INSERT INTO productos (nombre, cantidad, precio, fecha_compra) VALUES (?, ?, ?, ?)",
                    (nombre, cantidad, precio, fecha_compra))
        con.commit()
        print("âœ… Producto agregado correctamente.")

# Mostrar inventario
def mostrar_inventario():
    with conectar_bd() as con:
        cur = con.cursor()
        cur.execute("SELECT * FROM productos")
        productos = cur.fetchall()
        
        print("\nðŸ“‹ Inventario de la ferreterÃ­a:")
        print("-" * 60)
        print(f"{'ID':<5}{'Nombre':<15}{'Cantidad':<10}{'Precio':<10}{'F. Compra':<15}{'F. Venta'}")
        print("-" * 60)
        for p in productos:
            print(f"{p[0]:<5}{p[1]:<15}{p[2]:<10}{p[3]:<10}{p[4]:<15}{p[5] if p[5] else 'N/A'}")

# Eliminar un producto
def eliminar_producto():
    mostrar_inventario()
    id_producto = int(input("\nID del producto a eliminar: "))
    
    with conectar_bd() as con:
        cur = con.cursor()
        cur.execute("DELETE FROM productos WHERE id = ?", (id_producto,))
        con.commit()
        print("âŒ Producto eliminado correctamente.")

# Calcular el IVA de un producto
def calcular_iva():
    mostrar_inventario()
    id_producto = int(input("\nID del producto para calcular el IVA: "))
    
    with conectar_bd() as con:
        cur = con.cursor()
        cur.execute("SELECT precio FROM productos WHERE id = ?", (id_producto,))
        producto = cur.fetchone()
        
        if producto:
            precio = producto[0]
            iva = precio * 0.16  # Suponiendo un IVA del 16%
            print(f"ðŸ§® El IVA del producto es: ${iva:.2f}")
        else:
            print("âŒ Producto no encontrado.")

# Verificar si hay productos agotados
def verificar_stock():
    with conectar_bd() as con:
        cur = con.cursor()
        cur.execute("SELECT nombre FROM productos WHERE cantidad <= 0")
        agotados = cur.fetchall()
        
        if agotados:
            nombres = ", ".join([p[0] for p in agotados])
            print(f"ðŸš¨ Productos agotados: {nombres}")
        else:
            print("âœ… No hay productos agotados.")

# MenÃº principal
def menu():
    inicializar_bd()
    
    while True:
        print("\nðŸ”¹ MenÃº de Inventario ðŸ”¹")
        print("1ï¸âƒ£ Agregar producto")
        print("2ï¸âƒ£ Mostrar inventario")
        print("3ï¸âƒ£ Eliminar producto")
        print("4ï¸âƒ£ Calcular IVA")
        print("5ï¸âƒ£ Verificar productos agotados")
        print("6ï¸âƒ£ Salir")
        
        opcion = input("\nSelecciona una opciÃ³n: ")
        
        if opcion == "1":
            agregar_producto()
        elif opcion == "2":
            mostrar_inventario()
        elif opcion == "3":
            eliminar_producto()
        elif opcion == "4":
            calcular_iva()
        elif opcion == "5":
            verificar_stock()
        elif opcion == "6":
            print("ðŸ‘‹ Saliendo del programa...")
            break
        else:
            print("âŒ OpciÃ³n invÃ¡lida, intenta de nuevo.")

# Ejecutar el programa
if __name__ == "__main__":
    menu()
